# Caddy reverse proxy for SGOS Docs
# Routes traffic to docs container, or serves maintenance page when flag exists

:4200 {
    # Check if maintenance mode is active
    @maintenance file /srv/maintenance-mode/maintenance.flag

    # Maintenance mode: serve static page
    handle @maintenance {
        root * /srv/maintenance-mode
        rewrite * /index.html
        file_server
        header Cache-Control "no-cache, no-store, must-revalidate"
    }

    # Normal mode: proxy to docs container
    handle {
        reverse_proxy docs:3000
    }

    # Logging
    log {
        output stdout
        format console
    }
}
